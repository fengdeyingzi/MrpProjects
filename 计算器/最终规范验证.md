# 功能机计算器 - 最终规范验证

## 验证时间
$(date)

## 已验证的规范符合性

### ✅ 1. 编译器与语言标准
- 使用 C98 标准
- 所有变量在函数或代码块开头声明
- 无 C99 特性使用

### ✅ 2. 头文件使用
- 使用 `<mrc_base.h>` 作为基础API
- 使用 `"uc3_font.h"` 进行字体绘制
- 使用 `"mrc_graphics.h"` 进行图形绘制
- 使用 `"mpc.h"` 进行基础功能转换
- **无标准C库头文件**（stdio.h, string.h, stdlib.h等）

### ✅ 3. 函数替代
- `malloc` → `mrc_malloc`
- `free` → `mrc_free`
- `memcpy` → `mrc_memcpy`
- `memset` → `mrc_memset`
- `strcpy` → `mrc_strcpy`
- `strcmp` → `mrc_strcmp`
- `sprintf` → `mrc_sprintf`
- `atoi` → `mrc_atoi`

### ✅ 4. 线程与定时器
- **无多线程使用**
- 使用 `mrc_timerCreate/Start` 模拟游戏循环
- 定时器频率：10fps（100ms间隔）

### ✅ 5. 窗口管理系统
- 使用枚举定义窗口类型
- 实现统一的窗口切换函数
- 在 `mrc_event` 中根据当前窗口分发事件
- 定时器回调中只在游戏窗口时执行逻辑

### ✅ 6. 软键提示规范
- 在屏幕底部显示软键提示文字
- 左软键："历史"（计算器窗口）、"返回"（历史窗口）、"确认"（帮助窗口）
- 右软键："退出"（计算器窗口）、"清除历史"（历史窗口）、"返回"（帮助窗口）
- 实现 `drawSoftKeyHints` 函数

### ✅ 7. 图形渲染规范
- 每次绘制后调用 `mrc_refreshScreen`
- 使用全局变量 `SCRW`、`SCRH` 获取屏幕尺寸
- 正确使用颜色格式（ARGB 和 RGB 分量）

### ✅ 8. 资源管理
- 在 `mrc_init` 中初始化资源
- 在 `mrc_exitApp` 中释放资源
- 管理定时器创建、启动、停止、删除

### ✅ 9. 按键和触摸事件
- 正确处理 `KY_UP`（按键松开）事件
- 正确处理 `MS_UP`（触摸松开）事件
- 使用正确的按键常量（`_SLEFT`、`_SRIGHT`等）

### ✅ 10. 常见陷阱避免
- 变量在函数开头声明
- for循环变量在循环外声明
- 使用 C89 风格注释 `/* */`
- 函数在使用前声明

## 文件清单

### 核心文件
1. `main.c` - 主程序（已修正，符合规范）
2. `ui_system.h/c` - UI系统（已修正，符合规范）
3. `calculator.h/c` - 计算器逻辑（已修正，符合规范）
4. `expression_evaluator.h/c` - 表达式求值（已重写，完全